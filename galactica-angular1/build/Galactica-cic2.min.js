/*! Galactica-cic2 2017-10-26 */

var galacticaApp=angular.module("galacticaApp",["ngRoute","cic2Controllers"]);galacticaApp.config(["$routeProvider",function(e){e.when("/characters",{templateUrl:"characterList.html",controller:"CharacterListController"}).when("/characters/:id",{templateUrl:"characterDetail.html",controller:"CharacterDetailController"}).when("/mainmenu",{templateUrl:"mainmenu.html",controller:"MainMenuController"}).when("/draftsetup",{templateUrl:"draft.html",controller:"DraftSetupController"}).when("/draft",{templateUrl:"draftCharacters.html",controller:"DraftController"}).when("/game",{templateUrl:"game.html",controller:"GameController"}).otherwise({redirectTo:"/characters"})}]);var cic2Controllers=angular.module("cic2Controllers",[]);cic2Controllers.controller("CharacterListController",["$scope","characterDataService",function(e,r){r.getCharacters(function(r){e.characters=r}),e.predicate="id"}]),cic2Controllers.controller("CharacterDetailController",["$scope","$routeParams","characterDataService",function(e,r,t){e.id=r.id,e.alternateExists=!1,e.isCylonLeader=!1,e.characters=void 0,t.getCharacters(function(t){e.character=t[r.id],e.characters=t,-1!=e.character.alternateOf&&(e.alternateExists=!0),"Cylon Leader"===e.character.type&&(e.isCylonLeader=!0)})}]),cic2Controllers.controller("MainMenuController",["$scope",function(e){}]),cic2Controllers.controller("DraftSetupController",["$scope","draftDeck","$location",function(e,r,t){e.hasData=!1,e.draftSetupBase=!0,e.draftSetupPegasus=!0,e.draftSetupExodus=!0,e.draftSetupDaybreak=!0,e.draftSetupCylonLeaders=!0,e.draftSetupRefuseCylonLeader=!0,e.draftSetupPlayers=5,e.draftSetupDone=!1,e.show7thPlayer=!0;var a=function(){"7"===e.draftSetupPlayers&&((e.draftSetupPegasus||e.draftSetupDaybreak)&&e.draftSetupCylonLeaders||(e.draftSetupPlayers="6")),e.draftSetupPegasus||e.draftSetupDaybreak||(e.draftSetupCylonLeaders=!1),(e.draftSetupPegasus||e.draftSetupDaybreak)&&e.draftSetupCylonLeaders?e.show7thPlayer=!0:e.show7thPlayer=!1};e.$watch("draftSetupPlayers",function(e,r){a()}),e.$watch("draftSetupPegasus",function(e,r){a()}),e.$watch("draftSetupDaybreak",function(e,r){a()}),e.$watch("draftSetupCylonLeaders",function(e,r){a()}),e.submitDraft=function(){e.draftSetupDone=!0,r.setExpansion("Base",e.draftSetupBase),r.setExpansion("Pegasus",e.draftSetupPegasus),r.setExpansion("Exodus",e.draftSetupExodus),r.setExpansion("Daybreak",e.draftSetupDaybreak),r.setAllowCylonLeaders(e.draftSetupCylonLeaders),r.setAllowRefuseCylonLeader(e.draftSetupRefuseCylonLeader),r.setPlayerAmount(e.draftSetupPlayers),console.log("Draft submitted "+e.draftSetupDone),r.createCharacterSet(),t.path("/draft")}}]),cic2Controllers.controller("DraftController",["$scope","draftDeck","$location",function(e,r,t){e.isReady=r.isReady(),e.characters=r.selectableCharacters(),e.isCylonLeaderPresent=!1,e.selectedCharacters=r.selectedCharacters(),e.$watch("isReady",function(r,a){!1===e.isReady&&t.path("/draftsetup")}),e.$watch("characters",function(t,a){e.characters&&("Cylon Leader"!==e.characters[0].type&&"Cylon Leader"!==e.characters[1].type||!r.canRefuseCylonLeader()?e.isCylonLeaderPresent=!1:e.isCylonLeaderPresent=!0)}),e.$watch("selectedCharacters",function(r,t){for(var a=0;a<e.selectedCharacters.length;a++);}),e.selectCharacter=function(a,n){r.selectCharacter(n),e.characters=r.selectableCharacters(),e.selectedCharacters=r.selectedCharacters(),r.canRefuseCylonLeader()||(e.isCylonLeaderPresent=!1),r.isDraftFinished()&&t.path("/game")},e.redrawCylons=function(){e.characters=r.redrawCylons(e.characters),e.isCylonLeaderPresent=!1},e.checkCharacterTitle=function(r,t,a){var n=100;if("draft"===t){if("Cylon Leader"===e.characters[a].type)return!1}else if("selected"===t&&"Cylon Leader"===e.selectedCharacters[a].type)return!1;var c=function(e,r){var t=0;return"president"===r?t=e.presidentInheritance:"admiral"===r?t=e.admiralInheritance:"cag"===r&&(t=e.cagInheritance),t};if(!e.selectedCharacters)return!0;for(var o=0;o<e.selectedCharacters.length;o++){var l=c(e.selectedCharacters[o],r);l<n&&(n=l)}return"draft"===t?c(e.characters[a],r)<n:"selected"===t?c(e.selectedCharacters[a],r)<n:void 0}}]),cic2Controllers.controller("GameController",["$scope","draftDeck","$location",function(e,r,t){e.characters=r.selectedCharacters(),e.predicate="id"}]),cic2Controllers.factory("characterDataService",["$http",function(e){var r={};return r.characterData=null,r.getCharacters=function(t){null===r.characterData?e.get("characterData.json").success(function(e){r.characterData=e,t(e)}):t(r.characterData)},r.getCharacterByIndex=function(e){return r.characterData?e<0||e>=r.characterData.length?null:r.characterData[e]:null},r.getCharacterAmount=function(){return r.characterData?r.characterData.length:null},r}]),cic2Controllers.factory("draftDeck",["characterDataService",function(e){var r={},t=null,a=new Array,n=!1,c=!1,o=5,l=new Array,s=!1,i=void 0,d=new Array,u=0,h=!1;r.setExpansion=function(e,r){for(var t=0;t<a.length;t++)if(a[t].expansion===e)return void(a[t].isInGame=r);a.push({expansion:e,isInGame:r})},r.setAllowCylonLeaders=function(e){n=e},r.setAllowRefuseCylonLeader=function(e){c=e},r.canRefuseCylonLeader=function(){return c},r.setPlayerAmount=function(e){o=parseInt(e)},r.canRefuseCylonLeader=function(){return c};var f=function(){for(var e=[0,0],r=[0,0],t=[0,0],a=0,n=0,c=0,o=0;o<d.length;o++)a=d[o].admiralInheritance,n=d[o].cagInheritance,c=d[o].presidentInheritance,"Cylon Leader"!==d.type&&((a<e[0]||0===e[0])&&(e[0]=a,e[1]=o),(n<r[0]||0===r[0])&&(r[0]=n,r[1]=o),(c<t[0]||0===t[0])&&(t[0]=c,t[1]=o));for(var l=0;l<d.length;l++)l===e[1]?d[l].isAdmiral=!0:d[l].isAdmiral=!1,l===r[1]?d[l].isCag=!0:d[l].isCag=!1,l===t[1]?d[l].isPresident=!0:d[l].isPresident=!1},p=function(){t=new Array;for(var c=e.getCharacterAmount(),l=0;l<c;l++)for(var i=0;i<a.length;i++){var d=e.getCharacterByIndex(l);d.set===a[i].expansion&&!0===a[i].isInGame&&("Cylon Leader"===d.type&&n||"Cylon Leader"!==d.type)&&(console.log("Character added: "+d.name),t.push(d))}s=!0,r.takeSelectionTurn(),console.log("Characters in game: "+t.length+". Players: "+o)};return r.isReady=function(){return s},r.createCharacterSet=function(){if(t)for(;t.length>0;)t.pop();e.getCharacters(function(e){p()})},r.pop=function(){return t.splice(t.length-1,1)[0]},r.popRandomCard=function(){var e=Math.floor(Math.random()*t.length),a=t[e];if(void 0!=l)for(var n=0;n<l.length;n++)if(l[n]===a.type)return r.popRandomCard();return e<t.length-1?(subdeck=t.slice(e+1,t.length),t.splice(e,t.length-e),t=t.concat(subdeck),a):r.pop()},r.takeSelectionTurn=function(){6===u&&(c=!1,r.isTypeOmited("Cylon Leader")||(l=["Pilot","Political Leader","Military Leader","Support"])),i=[r.popRandomCard(),r.popRandomCard()]},r.isTypeOmited=function(e){var r;if(l)for(r=0;r<l.length;r++)if(l[r]===e)return!0;return!1},r.checkForTypeValidity=function(){var e,r=!1,t=!1,a=!1,n=!1,c=d[d.length-1].type;if("Support"!==c){for(l||(l=new Array),l.push(c),e=0;e<l.length;e++)"Military Leader"===l[e]?t=!0:"Political Leader"===l[e]?a=!0:"Pilot"===l[e]?r=!0:"Cylon Leader"===l[e]&&(n=!0);if(t&&a&&r){for(;l.length>0;)l.pop();n&&l.push("Cylon Leader")}}},r.selectCharacter=function(e){if(u<o){u++;var a=void 0,n=void 0;0===e?(n=i.pop(),a=i.pop()):(a=i.pop(),n=i.pop()),t.push(n),d.push(a),r.checkForTypeValidity(),f(),r.removeAlternates(a.id),u<o?r.takeSelectionTurn():h=!0}else h=!0},r.isDraftFinished=function(){return h},r.removeAlternates=function(e){if(-1!==e)for(var a=0;a<t.length;a++){var n=t[a];if(n.alternateOf===e){if(a<t.length-1){var c=t.slice(a+1,t.length);return t.splice(a,t.length-a),void(t=t.concat(c))}return void(n=r.pop())}}},r.redrawCylons=function(e){var a,n,c;for(a=0;a<e.length;a++)"Cylon Leader"===(n=e[a]).type&&(l.push("Cylon Leader"),c=r.popRandomCard(),t.push(n),e[a]=c,l.splice(l.length-1,1));return e},r.selectableCharacters=function(){return i},r.selectedCharacters=function(){return d},r}]);